var h=Object.defineProperty;var S=Object.getOwnPropertyDescriptor;var b=Object.getOwnPropertyNames;var y=Object.prototype.hasOwnProperty;var I=(i,e)=>{for(var t in e)h(i,t,{get:e[t],enumerable:!0})},f=(i,e,t,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of b(e))!y.call(i,o)&&o!==t&&h(i,o,{get:()=>e[o],enumerable:!(s=S(e,o))||s.enumerable});return i};var x=i=>f(h({},"__esModule",{value:!0}),i);var A={};I(A,{default:()=>r});module.exports=x(A);var n=require("obsidian"),k={token:"",agentId:""},p=class extends n.Modal{constructor(t,s){super(t);this.result=null;this.placeholder=s}onOpen(){let{contentEl:t}=this;t.addClass("timeweb-instruction-modal"),t.createEl("h3",{text:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0442\u0435\u043A\u0441\u0442 \u0438\u043B\u0438 \u0438\u043D\u0441\u0442\u0440\u0443\u043A\u0446\u0438\u044E"});let s=t.createEl("textarea");s.placeholder=this.placeholder,s.focus();let o=t.createDiv({cls:"button-container"}),c=o.createEl("button",{text:"\u041E\u0442\u043C\u0435\u043D\u0430"});c.onclick=()=>{this.result=null,this.close()};let d=o.createEl("button",{text:"\u041E\u0442\u043F\u0440\u0430\u0432\u0438\u0442\u044C"});d.onclick=()=>{this.result=s.value,this.close()},s.addEventListener("keypress",a=>{a.key==="Enter"&&a.shiftKey||a.key==="Enter"&&(this.result=s.value,this.close())})}onClose(){this.contentEl.empty()}},r=class extends n.Plugin{async onload(){console.log("\u2705 Timeweb AI Plugin loaded"),await this.loadSettings(),this.addCommand({id:"timeweb-transform-selection",name:"Timeweb: \u041F\u0440\u0435\u043E\u0431\u0440\u0430\u0437\u043E\u0432\u0430\u0442\u044C \u0442\u0435\u043A\u0441\u0442 (\u0432\u044B\u0434\u0435\u043B\u0435\u043D\u043D\u044B\u0439 \u0438\u043B\u0438 \u043D\u043E\u0432\u044B\u0439)",editorCallback:async()=>{if(!this.settings.token||!this.settings.agentId){new n.Notice("\u26A0 \u0423\u043A\u0430\u0436\u0438 \u0442\u043E\u043A\u0435\u043D \u0438 Agent ID \u0432 \u043D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0430\u0445");return}let e=this.app.workspace.getActiveViewOfType(n.MarkdownView);if(!e){new n.Notice("\u26A0 \u041D\u0435\u0442 \u0430\u043A\u0442\u0438\u0432\u043D\u043E\u0433\u043E \u0440\u0435\u0434\u0430\u043A\u0442\u043E\u0440\u0430");return}let t=e.editor,s=t.getCursor("from"),o=t.getCursor("to"),c=t.getSelection(),d=c?"\u0427\u0442\u043E \u0441\u0434\u0435\u043B\u0430\u0442\u044C \u0441 \u0432\u044B\u0434\u0435\u043B\u0435\u043D\u043D\u044B\u043C \u0442\u0435\u043A\u0441\u0442\u043E\u043C?":"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0442\u0435\u043A\u0441\u0442 \u0434\u043B\u044F \u043E\u0442\u043F\u0440\u0430\u0432\u043A\u0438",a=new p(this.app,d);a.open(),await new Promise(l=>{a.onClose=()=>l()});let g=a.result;if(!g)return;t.setSelection(s,o);let m=`\u0418\u043D\u0441\u0442\u0440\u0443\u043A\u0446\u0438\u044F: ${c?g:"\u041E\u0431\u0440\u0430\u0431\u043E\u0442\u0430\u0439 \u0442\u0435\u043A\u0441\u0442"}

\u0422\u0435\u043A\u0441\u0442:
${c||g}`,u=new n.Notice("\u23F3 \u0413\u0435\u043D\u0435\u0440\u0430\u0446\u0438\u044F...",0);try{let l=await(0,n.requestUrl)({url:`https://api.timeweb.cloud/api/v1/cloud-ai/agents/${this.settings.agentId}/call`,method:"POST",headers:{Authorization:`Bearer ${this.settings.token}`,"Content-Type":"application/json"},body:JSON.stringify({message:m}),throw:!1});if(l.status!==200){u.hide(),new n.Notice(`\u274C \u041E\u0448\u0438\u0431\u043A\u0430 API: ${l.status}`);return}let T=l.json?.message??"\u274C \u041D\u0435\u0442 \u043E\u0442\u0432\u0435\u0442\u0430";t.replaceSelection(T),u.hide(),new n.Notice("\u2705 \u041E\u0442\u0432\u0435\u0442 \u0432\u0441\u0442\u0430\u0432\u043B\u0435\u043D \u0432 \u0437\u0430\u043C\u0435\u0442\u043A\u0443",3e3)}catch(l){console.error(l),u.hide(),new n.Notice("\u274C \u041E\u0448\u0438\u0431\u043A\u0430 \u0437\u0430\u043F\u0440\u043E\u0441\u0430 \u0438\u043B\u0438 \u0442\u0430\u0439\u043C\u0430\u0443\u0442 (30 \u0441\u0435\u043A\u0443\u043D\u0434)")}}}),this.addSettingTab(new w(this.app,this))}onunload(){console.log("\u{1F6D1} Timeweb AI Plugin unloaded")}async loadSettings(){this.settings=Object.assign({},k,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}},w=class extends n.PluginSettingTab{constructor(e,t){super(e,t),this.plugin=t}display(){let{containerEl:e}=this;e.empty(),e.createEl("h2",{text:"\u2699\uFE0F \u041D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438 Timeweb AI"}),new n.Setting(e).setName("API Token").setDesc("\u0422\u043E\u043A\u0435\u043D \u0430\u0432\u0442\u043E\u0440\u0438\u0437\u0430\u0446\u0438\u0438 Timeweb").addText(t=>t.setPlaceholder("\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0442\u043E\u043A\u0435\u043D").setValue(this.plugin.settings.token).onChange(async s=>{this.plugin.settings.token=s,await this.plugin.saveSettings()})),new n.Setting(e).setName("Agent ID").setDesc("ID \u0442\u0432\u043E\u0435\u0433\u043E AI-\u0430\u0433\u0435\u043D\u0442\u0430").addText(t=>t.setPlaceholder("\u0412\u0432\u0435\u0434\u0438\u0442\u0435 Agent ID").setValue(this.plugin.settings.agentId).onChange(async s=>{this.plugin.settings.agentId=s,await this.plugin.saveSettings()}))}};
